var ShowGiftAnimate={datas:[],bigDatas:[],isAllPlaying:!1,showSize:2,container:"js-gift-show-container",bigContainer:$("#js-show-big-gift-wrap"),bigGiftTpl:$("#js-big-gift-wrap-tpl"),duration:2e3,timerArr:[],isInit:!1,isGetGift:!1,giftInfoList:[],readyBig:[65,132],isBigPlaying:!1,creatList:function(){for(var i=0;i<$(".gift-pic").length;i++){var t={id:$(".gift-list li:eq("+i+")").attr("data-id"),icon:$(".gift-pic:eq("+i+")").attr("src")};this.giftInfoList.push(t)}},init:function(i){var t=this;if(t.bigContainer.find(".big-gift-box").length||(t.bigContainer.append(t.bigGiftTpl.html()),console.log("append big gift tpl")),!t.giftInfoList.length&&!t.isGetGift)return t.isGetGift=!0,void t.getAllInfo();t.isGetGift&&t.giftInfoList.length&&(i.giftPic=t.getGiftPic(i.giftId),-1==t.readyBig.indexOf(i.giftId)?(t.datas.push(i),t.isAllPlaying||t.start()):Util.ua().android||(t.bigDatas.push(i),t.startBig()),t.isInit||(t.bindEvent(),t.isInit=!0))},getAllInfo:function(){var t=this;$.ajax({url:location.protocol+"//baseapi.busi.inke.cn/open_func/gift",dataType:"json",success:function(i){1*i.dm_error==0&&i.data?t.giftInfoList=i.data:t.giftInfoList=[]}})},getGiftPic:function(i){for(var t=this,n="",a=0,e=t.giftInfoList.length;a<e;a++)if(t.giftInfoList[a].id==i){n=t.giftInfoList[a].image;break}return n},start:function(){var f=this,g=f.datas,d=$("#"+f.container).children("li");d.each(function(i,t){var n=$(t);if("false"===n.attr("data-playing")&&0<g.length){for(var a=null,e=f.getCurIds(),o=0,s=g.length;o<s;o++){var r=g[o];if(-1==e.indexOf(r.fromId)){a=g.splice(o,1)[0];break}}a&&(f.showOne(n,a),i==d.length-1&&(f.isAllPlaying=!0))}})},showOne:function(t,i){var n=this;t.find(".name").html(i.nick||""),t.find(".giftType").html("送一个"+i.type),1*i.num==0&&(i.num=1),t.find(".star").attr("data-num",i.num).html("");var a=i.giftPic||"//img2.inke.cn/MTUwODc1MTA1NDUzNSMyMCNqcGc=.jpg";a.indexOf("http")<0&&(a=location.protocol+"//img2.inke.cn/"+i.giftPic),t.find(".giftImg img").attr("src",a);var e,o=location.protocol+"//img2.inke.cn/"+i.ptr;if(0<=i.ptr.indexOf("http")&&(o=i.ptr),t.find(".headImg img").attr("src",o),t.attr("data-fromId")==i.fromId){t.find(".pride").addClass("show");var s=t.find(".star");s.addClass("zoomIn").show().html("X"+(s.attr("data-num")||0)),setTimeout(function(){},50),e=t,setTimeout(function(){n.next(e)},n.duration)}else t.find(".pride").removeClass("show"),setTimeout(function(){var i;t.find(".pride").addClass("show"),t.find(".giftImg").removeClass("bounceInLeft"),setTimeout(function(){t.find(".giftImg").addClass("bounceInLeft")},50),i=t,setTimeout(function(){n.next(i)},n.duration)},30);t.attr("data-playing","true").attr("data-fromId",i.fromId)},next:function(i){var t=this,n=t.datas,a=(i.index(),i.attr("data-fromId")),e=null,o=t.getCurIds();if(0==n.length||!n)return t.hideOne(i),void(t.isAllPlaying=!1);if(n[0].fromId==a)e=n.shift();else{var s=n.length;if(1<n.length)for(var r=1;r<s;r++)if(-1==o.indexOf(n[r].fromId)){e=n.splice(r,1)[0];break}}e?t.showOne(i,e):(t.hideOne(i),t.isAllPlaying=!1)},getCurIds:function(){var a=[];return $("#"+this.container).children("li").each(function(i,t){var n=1*$(t).attr("data-fromId");n&&-1==a.indexOf(n)&&a.push(1*n)}),a},hideOne:function(i){i.find(".pride").removeClass("show"),i.attr("data-playing","false").removeAttr("data-fromId")},clearTimer:function(i){clearTimeout(i),i=null},startBig:function(){var i=this,t=i.bigDatas;if(t&&0!=t.length){if(!i.isBigPlaying){var n=t.shift(),a=n.giftId,e=$("#big-gift-box-"+a);e.length?($("#live-bg .play-btn").is(":hidden"),i.bigContainer.show(),e.find(".u-name").html(n.nick),e.find(".b-gift-type").html("送一个"+n.type),e.addClass("show"),i.isBigPlaying=!0):console.error("big gift id box is null")}}else i.bigContainer.hide()},bindEvent:function(){var n=this;$("#"+n.container).find(".star").bind("webkitAnimationStart",function(){}),$("#"+n.container).find(".giftImg").bind("webkitAnimationEnd",function(){var i=$(this).closest("li").find(".star");i.addClass("zoomIn").show().html("X"+(i.attr("data-num")||0))}),$("#"+n.container).find(".star").bind("webkitAnimationEnd",function(){$(this).removeClass("zoomIn")}),n.bigContainer.on("webkitAnimationEnd ",function(i){console.log("bigContainer webkitAnimationEnd");var t=$(i.target);(console.log(t),t.hasClass("big-gift-box")||t.hasClass("animate-main"))&&((t.hasClass("big-gift-box")?t:t.closest(".big-gift-box")).removeClass("show"),setTimeout(function(){n.isBigPlaying=!1,n.startBig()},50))})}};